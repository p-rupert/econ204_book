{"version":"1","records":[{"hierarchy":{"lvl1":"The HP Filter"},"type":"lvl1","url":"/hp1","position":0},{"hierarchy":{"lvl1":"The HP Filter"},"content":"Smoothing time series data is useful in many economic situations. The main idea is to try to separate a â€œtrendâ€ from a â€œcycle.â€ The smoothed series should not differ too much from the actual data. This is done through a choice of parameters in the filter.\n\nSuppose we have T observations on the log of some time series y_{t} for t=1,2, \\ldots , T, where y_{t} consists of a trend term, \\tau_{t}, and a cyclical component, c_{t}, so that y_{t} = \\tau_{t} + c_{t}.\n\nThe HP filter finds \\{\\tau_{t}\\} that solves\\min_{\\tau} \\Big(\\sum_{t=1}^{T} (c)^2 + \\lambda \\sum_{t=1}^{T} [(\\tau_{t}-\\tau_{t-1})-(\\tau_{t-1}-\\tau_{t-2})]^2  \\Big),\n\nor, rewriting\\min_{\\tau} \\Big(\\sum_{t=1}^{T} (y_{t}-\\tau_{t})^2 + \\lambda \\sum_{t=1}^{T} [(\\tau_{t}-\\tau_{t-1})-(\\tau_{t-1}-\\tau_{t-2})]^2  \\Big),\n\nwhere \\lambda is the ``smoothness penalty.â€˜â€™ Note that as \\lambda \\rightarrow 0, we just have the series, y_{t}, itself and \\lambda \\rightarrow \\infty is just a regression on a linear trend (second difference is 0). Here is a Python implementation:\n\nimport numpy as np\nimport pandas as pd\nimport pandas_datareader as pdr\nimport datetime\nfrom statsmodels.tsa.filters.hp_filter import hpfilter\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nfrom cycler import cycler\nfrom tabulate import tabulate\nfrom matplotlib.dates import DateFormatter\nfrom pandas.plotting import register_matplotlib_converters\nregister_matplotlib_converters\nimport matplotlib.ticker as ticker\n###from statsmodels.tsa.x13 import x13_arima_analysis\nimport sys\n### Some libraries for web scraping (BLS revisions)\nimport requests\nfrom bs4 import BeautifulSoup\nimport time\n\nstart_time = time.time()\n\npd.set_option('display.max_rows', None)\n\nmy_colors = [\"#00688b\",\n             \"#cd3333\",\n             \"#6c8b3d\", \n             \"cornflowerblue\",\n             \"#cd6600\",\n             \"#8b2323\",\n             \"#5d478b\",\n             \"red\"]\nplt.rcParams['axes.prop_cycle'] = cycler(color = my_colors)\nplt.rcParams['axes.spines.right'] = False\nplt.rcParams['axes.spines.top'] = False\nplt.rcParams['axes.xmargin'] = 0\n#plt.rcParams['axes.ymargin'] = 0.0\nplt.rcParams[\"figure.figsize\"] = (10.5,6.5)\nplt.rcParams['font.family'] = 'sans-serif'\nplt.rcParams['font.size'] = 14\nplt.rcParams['legend.fontsize'] = 'medium'\nplt.rcParams['legend.frameon'] = False\nplt.rcParams['legend.framealpha'] = None\nplt.rcParams[\"legend.loc\"] = 'best' \nplt.rcParams['axes.titlesize'] = 'xx-large'\nplt.rcParams['axes.titlecolor'] = '#3333B3FF'\nplt.rcParams['lines.linewidth'] = 3\n\nplt.rcParams['figure.subplot.left'] = 0\nplt.rcParams['figure.subplot.bottom'] = 0\nplt.rcParams['figure.subplot.right'] = 1\nplt.rcParams['figure.subplot.top'] = 1\n\ndef crosscorr(datax, datay, lag=0):\n   return datax.corr(datay.shift(lag))\n\ndef NBER(start_date):\n    ax2 = ax.twinx()\n    Recessions = monthly['recessiondates'][monthly.index >= start_date]\n    ax2.fill_between(Recessions.index,\n                     Recessions,\n                     step=\"pre\",\n                     color=\"gray\",\n                     alpha=0.2)\n    ax2.get_yaxis().set_visible(False)\n    return ax2\n\ndef simpleaxis(ax):\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False)\n    ax.get_xaxis().tick_bottom()\n    ax.get_yaxis().tick_left()\n\ndef day_format(label):\n    \"\"\"\n    Convert time label to the format of pandas line plot\n    \"\"\"\n    return f'{label.month} {label.day}'\n\ndef month_format(label):\n    \"\"\"\n    Convert time label to the format of pandas line plot\n    \"\"\"\n    month = label.month_name()[:3]\n    if month == 'Jan':\n        month = month + '\\n' + f'{label.year}'\n    #else:\n    #    month = \"\"\n    return month\n\ndef quarter_format(label):\n    \"\"\"\n    Convert time label to the format of pandas line plot\n    \"\"\"\n    month = label.month_name()[:3]\n    if month == 'Jan':\n        month = f'Q1\\n{label.year}'\n    if month == 'Apr':\n        month = 'Q2'\n    if month == 'Jul':\n        month = 'Q3'\n    if month == 'Oct':\n        month = 'Q4'\n    return month\n\n\n\n\nNow we will read in some data.\n\n### Quarterly\n\nFREDmap = {\n    'GDPC1': 'real_gdp'\n    }\n\nquarterly = pdr.DataReader(list(FREDmap.keys()), 'fred', datetime.datetime(1800,1,1))\nquarterly.rename(columns = FREDmap, inplace = True)\n\nquarterly.to_pickle('quarterly.pickle')\n\n\n\n\nquarterly['real_gdp'].tail()\n\n\n\ndef EconLineGraph(dataframe = None,\n                  series = None,\n                  labels = None,\n                  title = None,\n                  subtitle = None,\n                  source = None,\n                  ylabel = None,\n                  start_date = None,\n                  end_date = None,\n                  graph_name = None,\n                  recessions = False,\n                  logscale = False,\n                  ylines = None,\n                  yzero = False):\n   \"\"\"For creating line graphs from a data frame\n\n    Inputs:\n    -------\n    dataframe : dataframe\n         The dataframe containing the data to be plotted                           \n    series : vector of text\n         The \"names\" of the variables to be plotted\n    labels : vector of text\n         The labels (descriptions) of each variable\n    title : text string\n         Title for the figure\n    subtitle : text string\n         A \"title\" which appears at top left of the figure\n    source : text string\n         The source for the data; appears at bottom right of the figure\n    ylabel : text string\n         Text that appears beside the y axis\n    start_date : string\n         The first date to appear in the figure (end date is always the last available\n         observation). String as 'yyyy-mm-dd'.\n    graph_name : text string\n         The basename for the graph files. Both pdf and png files are produced\n    recessions : logical\n         If True, then include NBER business cycle recession shading from \n         the dataframe \"monthly\"\n    \"\"\"\n    \n   if start_date == None:\n      df = dataframe[series].dropna(how = 'all')\n      start_date = df.first_valid_index()\n   else:\n      df = dataframe.loc[start_date:][series].dropna(how = 'all')\n\n   fig, ax = plt.subplots()\n       \n   if logscale:\n      ax.set_yscale('log')\n      ax.yaxis.set_major_formatter(plt.FormatStrFormatter(\"%.0f\"))\n      ax.yaxis.set_minor_formatter(plt.FormatStrFormatter(\"%.0f\"))\n\n   if recessions:\n      ax.plot(df, clip_on = False)\n   else:\n      df.plot(ax = ax, clip_on = False)\n\n   if yzero is True:\n      plt.axhline(y = 0, color = '#a0a0a0', linewidth = 0.75, label = None)\n   else:\n      if ylines is not None:\n         if len(ylines) == 1:\n            df[str(ylines)] = ylines[0]\n            df[str(ylines)].loc[start_date:].plot(ax = ax, clip_on = False, color = '#a0a0a0', linewidth = 1.0)\n         else:\n            for i in ylines:\n               df[str(i)] = i\n               df[str(i)].loc[start_date:].plot(ax = ax, clip_on = False, color = '#a0a0a0', linewidth = 1.0)\n      \n   if title is not None:\n      ax.set_title(title)\n\n   if subtitle is not None:\n      ax.set_title(subtitle,\n                   loc = 'left',\n                   color = 'black',\n                   size = 'medium')\n\n   if ylabel is not None:\n      ax.set_ylabel(ylabel)\n\n   if labels is not None:\n      #if ax.get_legend() != None:\n      ax.legend(labels)\n      #ax.legend().set_zorder(2)\n   else:\n      if ax.get_legend() != None:\n         ax.legend().set_visible(False)\n\n   if source is not None:\n      ax.set_xlabel('Source: ' + source,\n                    horizontalalignment='right',\n                    x=1.0)\n   else:\n      ax.set_xlabel('')\n\n   if recessions:\n      ax2 = ax.twinx()\n      Recessions = monthly['recessiondates'][monthly.index >= start_date]\n      ax2.fill_between(Recessions.index,\n                       Recessions,\n                       step=\"pre\",\n                       color=\"gray\",\n                       alpha=.2)\n      ax2.get_yaxis().set_visible(False)\n      ax2.set_ymargin(0) \n\n   fig.savefig('pyfigs/pdf/' + graph_name + '.pdf', bbox_inches='tight', pad_inches=0.25)\n   fig.savefig('pyfigs/png/' + graph_name + '.png', bbox_inches='tight', pad_inches=0.25)\n   \n\n\n\n\n\nEconLineGraph(dataframe = quarterly,\n              series = ['real_gdp'],\n              title = 'Real GDP\\n',\n              subtitle = 'Billions of Chained 2017 Dollars',\n              source = 'BEA',\n              start_date = '1947-01-01',\n              graph_name = 'log_real_gdp',\n              logscale= False)\n\n\n\n\nTake the log of real gdp and create the hpfilter, using 1600 for \\lambda.\n\nquarterly['lrgdp'] = np.log(quarterly['real_gdp'])\nhpcycle_gdp, hptrend_gdp = hpfilter(quarterly['lrgdp'].dropna(), lamb=1600)\nquarterly['hptrend_gdp'] = hptrend_gdp\nquarterly['hpcycle_gdp'] = hpcycle_gdp\n\n\n\nNow graph the real gdp series and the hp trend.\n\nEconLineGraph(dataframe = quarterly,\n          series = ['lrgdp', 'hptrend_gdp'],\n          labels = ['GDP', 'HP Trend'],\n          title = 'Real GDP and HP Trend\\n',\n          subtitle = 'Log of Trillions of 2017 Dollars',\n          source = 'BEA',\n          start_date = '1947-01-01',\n          graph_name = 'hp_log_real_gdp',\n          logscale= False)\n\n\n\n\n\n\n\nEconLineGraph(dataframe = quarterly,\n          series = ['hpcycle_gdp'],\n          title = 'Real GDP Cyclical Component\\n',\n          subtitle = 'Log of Trillions of 2017 Dollars',\n          source = 'BEA',\n          start_date = '1947-01-01',\n          graph_name = 'hp_cycle_log_real_gdp',\n          yzero = True,\n          logscale= False)\n\n\n\nHomework #1:\n\n(A) Use a very large number for \\lambda, like 16000000000 and see the trend and cycle. Explain what is going on. Next plot the cylical component for the two different \\lambdaâ€™s and comment on the difference.\n\n(B) Download GDPCA from FRED. This is annual real GDP back to 1929. Should you use \\lambda=1600? Why or why not? If not, what value should you use? Why?","type":"content","url":"/hp1","position":1},{"hierarchy":{"lvl1":"Econ 204 Lecture Notes"},"type":"lvl1","url":"/intro","position":0},{"hierarchy":{"lvl1":"Econ 204 Lecture Notes"},"content":"Welcome! This site contains lecture notebooks and notes for Econ 204.\n\nUse the ðŸ“‹ button to copy code from cells.\n\nEach lecture is listed in the table of contents.","type":"content","url":"/intro","position":1}]}