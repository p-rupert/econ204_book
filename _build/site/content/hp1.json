{"version":3,"kind":"Notebook","sha256":"91fe4b2362478318dcdce054a1adcabcbf42f237b54352a69cde4095de39e357","slug":"hp1","location":"/hp1.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"conda-env-anaconda3-py","display_name":"Python [conda env:anaconda3]","language":"python"},"exports":[{"format":"ipynb","filename":"hp1.ipynb","url":"/hp1-93570e797a8847a789a47f2af55e4dfe.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"","value":"# The HP Filter\n\n## Learning objectives\n- Understand trend–cycle decomposition\n- Interpret the smoothing parameter $\\lambda$\n\nSmoothing time series data is useful in many economic situations. The main idea is to try to separate a \"trend\" from a \"cycle.\" The smoothed series should not differ too much from the actual data. This is done through a choice of parameters in the filter. \n\n## Setup\n Suppose we have $T$ observations on the log of some time series $y_{t}$ for $t=1,2, \\ldots , T$, where $y_{t}$ consists of a trend term, $\\tau_{t}$, and a cyclical component, $c_{t}$, so that $y_{t} = \\tau_{t} + c_{t}$. \n\nThe HP filter finds $\\{\\tau_{t}\\}$ that solves\n\n$$ \n\\min_{\\tau} \\Big(\\sum_{t=1}^{T} (c)^2 + \\lambda \\sum_{t=1}^{T} [(\\tau_{t}-\\tau_{t-1})-(\\tau_{t-1}-\\tau_{t-2})]^2  \\Big), \n$$\nor, rewriting\n$$ \n \\min_{\\tau} \\Big(\\sum_{t=1}^{T} (y_{t}-\\tau_{t})^2 + \\lambda \\sum_{t=1}^{T} [(\\tau_{t}-\\tau_{t-1})-(\\tau_{t-1}-\\tau_{t-2})]^2  \\Big),\n$$\n\n##\n\nwhere $\\lambda$ is the ``smoothness penalty.'' Note that as $\\lambda \\rightarrow 0$, we just have the series, $y_{t}$, itself and $\\lambda \\rightarrow \\infty$ is just a regression on a linear trend (second difference is $0$). Here is a Python implementation:","key":"mXNNLpeKKO"}],"key":"E7Y43LqG1v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport pandas as pd\nimport pandas_datareader as pdr\nimport datetime\nfrom statsmodels.tsa.filters.hp_filter import hpfilter\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nfrom cycler import cycler\nfrom tabulate import tabulate\nfrom matplotlib.dates import DateFormatter\nfrom pandas.plotting import register_matplotlib_converters\nregister_matplotlib_converters\nimport matplotlib.ticker as ticker\n###from statsmodels.tsa.x13 import x13_arima_analysis\nimport sys\n### Some libraries for web scraping (BLS revisions)\nimport requests\nfrom bs4 import BeautifulSoup\nimport time\n\nstart_time = time.time()\n\npd.set_option('display.max_rows', None)\n\nmy_colors = [\"#00688b\",\n             \"#cd3333\",\n             \"#6c8b3d\", \n             \"cornflowerblue\",\n             \"#cd6600\",\n             \"#8b2323\",\n             \"#5d478b\",\n             \"red\"]\nplt.rcParams['axes.prop_cycle'] = cycler(color = my_colors)\nplt.rcParams['axes.spines.right'] = False\nplt.rcParams['axes.spines.top'] = False\nplt.rcParams['axes.xmargin'] = 0\n#plt.rcParams['axes.ymargin'] = 0.0\nplt.rcParams[\"figure.figsize\"] = (10.5,6.5)\nplt.rcParams['font.family'] = 'sans-serif'\nplt.rcParams['font.size'] = 14\nplt.rcParams['legend.fontsize'] = 'medium'\nplt.rcParams['legend.frameon'] = False\nplt.rcParams['legend.framealpha'] = None\nplt.rcParams[\"legend.loc\"] = 'best' \nplt.rcParams['axes.titlesize'] = 'xx-large'\nplt.rcParams['axes.titlecolor'] = '#3333B3FF'\nplt.rcParams['lines.linewidth'] = 3\n\nplt.rcParams['figure.subplot.left'] = 0\nplt.rcParams['figure.subplot.bottom'] = 0\nplt.rcParams['figure.subplot.right'] = 1\nplt.rcParams['figure.subplot.top'] = 1\n\ndef crosscorr(datax, datay, lag=0):\n   return datax.corr(datay.shift(lag))\n\ndef NBER(start_date):\n    ax2 = ax.twinx()\n    Recessions = monthly['recessiondates'][monthly.index >= start_date]\n    ax2.fill_between(Recessions.index,\n                     Recessions,\n                     step=\"pre\",\n                     color=\"gray\",\n                     alpha=0.2)\n    ax2.get_yaxis().set_visible(False)\n    return ax2\n\ndef simpleaxis(ax):\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False)\n    ax.get_xaxis().tick_bottom()\n    ax.get_yaxis().tick_left()\n\ndef day_format(label):\n    \"\"\"\n    Convert time label to the format of pandas line plot\n    \"\"\"\n    return f'{label.month} {label.day}'\n\ndef month_format(label):\n    \"\"\"\n    Convert time label to the format of pandas line plot\n    \"\"\"\n    month = label.month_name()[:3]\n    if month == 'Jan':\n        month = month + '\\n' + f'{label.year}'\n    #else:\n    #    month = \"\"\n    return month\n\ndef quarter_format(label):\n    \"\"\"\n    Convert time label to the format of pandas line plot\n    \"\"\"\n    month = label.month_name()[:3]\n    if month == 'Jan':\n        month = f'Q1\\n{label.year}'\n    if month == 'Apr':\n        month = 'Q2'\n    if month == 'Jul':\n        month = 'Q3'\n    if month == 'Oct':\n        month = 'Q4'\n    return month\n","key":"QV6xbl1OLZ"},{"type":"outputs","id":"vpob-5tNnpzHwe-YV0epw","children":[],"key":"LcrVPL7Spm"}],"key":"h9WGpfkivQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we will read in some data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kXLpLFpEok"}],"key":"CaMyNTOcSe"}],"key":"hhkKuiRczM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"### Quarterly\n\nFREDmap = {\n    'GDPC1': 'real_gdp'\n    }\n\nquarterly = pdr.DataReader(list(FREDmap.keys()), 'fred', datetime.datetime(1800,1,1))\nquarterly.rename(columns = FREDmap, inplace = True)\n\nquarterly.to_pickle('quarterly.pickle')\n","key":"KOt62hhTFs"},{"type":"outputs","id":"bP4IwjlPP7rk_aduuC5Ep","children":[],"key":"SURxVjV4zc"}],"key":"FQWyp1Jg2S"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"quarterly['real_gdp'].tail()","key":"vBxyVh6KvB"},{"type":"outputs","id":"yAEOoaFhAc8rGlAhB-r2O","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":35,"metadata":{},"data":{"text/plain":{"content":"DATE\n2023-07-01    22780.933\n2023-10-01    22960.600\n2024-01-01    23053.545\n2024-04-01    23223.906\n2024-07-01    23386.733\nName: real_gdp, dtype: float64","content_type":"text/plain"}}},"children":[],"key":"wd3Xwk6mlZ"}],"key":"hfbkDLE1UB"}],"key":"dvI71OIhnj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def EconLineGraph(dataframe = None,\n                  series = None,\n                  labels = None,\n                  title = None,\n                  subtitle = None,\n                  source = None,\n                  ylabel = None,\n                  start_date = None,\n                  end_date = None,\n                  graph_name = None,\n                  recessions = False,\n                  logscale = False,\n                  ylines = None,\n                  yzero = False):\n   \"\"\"For creating line graphs from a data frame\n\n    Inputs:\n    -------\n    dataframe : dataframe\n         The dataframe containing the data to be plotted                           \n    series : vector of text\n         The \"names\" of the variables to be plotted\n    labels : vector of text\n         The labels (descriptions) of each variable\n    title : text string\n         Title for the figure\n    subtitle : text string\n         A \"title\" which appears at top left of the figure\n    source : text string\n         The source for the data; appears at bottom right of the figure\n    ylabel : text string\n         Text that appears beside the y axis\n    start_date : string\n         The first date to appear in the figure (end date is always the last available\n         observation). String as 'yyyy-mm-dd'.\n    graph_name : text string\n         The basename for the graph files. Both pdf and png files are produced\n    recessions : logical\n         If True, then include NBER business cycle recession shading from \n         the dataframe \"monthly\"\n    \"\"\"\n    \n   if start_date == None:\n      df = dataframe[series].dropna(how = 'all')\n      start_date = df.first_valid_index()\n   else:\n      df = dataframe.loc[start_date:][series].dropna(how = 'all')\n\n   fig, ax = plt.subplots()\n       \n   if logscale:\n      ax.set_yscale('log')\n      ax.yaxis.set_major_formatter(plt.FormatStrFormatter(\"%.0f\"))\n      ax.yaxis.set_minor_formatter(plt.FormatStrFormatter(\"%.0f\"))\n\n   if recessions:\n      ax.plot(df, clip_on = False)\n   else:\n      df.plot(ax = ax, clip_on = False)\n\n   if yzero is True:\n      plt.axhline(y = 0, color = '#a0a0a0', linewidth = 0.75, label = None)\n   else:\n      if ylines is not None:\n         if len(ylines) == 1:\n            df[str(ylines)] = ylines[0]\n            df[str(ylines)].loc[start_date:].plot(ax = ax, clip_on = False, color = '#a0a0a0', linewidth = 1.0)\n         else:\n            for i in ylines:\n               df[str(i)] = i\n               df[str(i)].loc[start_date:].plot(ax = ax, clip_on = False, color = '#a0a0a0', linewidth = 1.0)\n      \n   if title is not None:\n      ax.set_title(title)\n\n   if subtitle is not None:\n      ax.set_title(subtitle,\n                   loc = 'left',\n                   color = 'black',\n                   size = 'medium')\n\n   if ylabel is not None:\n      ax.set_ylabel(ylabel)\n\n   if labels is not None:\n      #if ax.get_legend() != None:\n      ax.legend(labels)\n      #ax.legend().set_zorder(2)\n   else:\n      if ax.get_legend() != None:\n         ax.legend().set_visible(False)\n\n   if source is not None:\n      ax.set_xlabel('Source: ' + source,\n                    horizontalalignment='right',\n                    x=1.0)\n   else:\n      ax.set_xlabel('')\n\n   if recessions:\n      ax2 = ax.twinx()\n      Recessions = monthly['recessiondates'][monthly.index >= start_date]\n      ax2.fill_between(Recessions.index,\n                       Recessions,\n                       step=\"pre\",\n                       color=\"gray\",\n                       alpha=.2)\n      ax2.get_yaxis().set_visible(False)\n      ax2.set_ymargin(0) \n\n   fig.savefig('pyfigs/pdf/' + graph_name + '.pdf', bbox_inches='tight', pad_inches=0.25)\n   fig.savefig('pyfigs/png/' + graph_name + '.png', bbox_inches='tight', pad_inches=0.25)\n   \n\n","key":"am35iGSLrY"},{"type":"outputs","id":"Cr9hpac6qjDjrDnh3XiU3","children":[],"key":"R0u7G74koc"}],"key":"SdRQl8zrM8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"EconLineGraph(dataframe = quarterly,\n              series = ['real_gdp'],\n              title = 'Real GDP\\n',\n              subtitle = 'Billions of Chained 2017 Dollars',\n              source = 'BEA',\n              start_date = '1947-01-01',\n              graph_name = 'log_real_gdp',\n              logscale= False)\n","key":"aLsKlrBU2n"},{"type":"outputs","id":"xurNG5xYYm_mb83KyG2Gb","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6877796cdd2aa91f06ee13df07504525","path":"/6877796cdd2aa91f06ee13df07504525.png"},"text/plain":{"content":"<Figure size 1050x650 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"ecdo9NWPAs"}],"key":"yevrln7yxV"}],"key":"FW8ltoPfpF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Take the log of real gdp and create the hpfilter, using 1600 for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vAibjtuGKZ"},{"type":"inlineMath","value":"\\lambda","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span>","key":"SmMLhqKBtc"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"luwvapa8uc"}],"key":"U8GtuWirMV"}],"key":"BcXIxLvmi1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"quarterly['lrgdp'] = np.log(quarterly['real_gdp'])\nhpcycle_gdp, hptrend_gdp = hpfilter(quarterly['lrgdp'].dropna(), lamb=1600)\nquarterly['hptrend_gdp'] = hptrend_gdp\nquarterly['hpcycle_gdp'] = hpcycle_gdp","key":"nSBYYC69Yl"},{"type":"outputs","id":"mFOlJoQwwnKk4hnYiUNxZ","children":[],"key":"PYAqwsUcfw"}],"key":"bSry1uarrw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now graph the real gdp series and the hp trend.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GPme2rowdU"}],"key":"argQbqTaYg"}],"key":"dNFaARZr5j"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"EconLineGraph(dataframe = quarterly,\n          series = ['lrgdp', 'hptrend_gdp'],\n          labels = ['GDP', 'HP Trend'],\n          title = 'Real GDP and HP Trend\\n',\n          subtitle = 'Log of Trillions of 2017 Dollars',\n          source = 'BEA',\n          start_date = '1947-01-01',\n          graph_name = 'hp_log_real_gdp',\n          logscale= False)","key":"i3AfZ7uMjx"},{"type":"outputs","id":"DA1Hq1jGyMu0GuFbGtT7l","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"201615afa8971efff931389c7d9c6725","path":"/201615afa8971efff931389c7d9c6725.png"},"text/plain":{"content":"<Figure size 1050x650 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"s1dt3oNsgA"}],"key":"LcjvSQlmeT"}],"key":"UfI5D6a3rs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"hVvSRfoJGD"},{"type":"outputs","id":"uC328m3s2h1KPqrhS8bdp","children":[],"key":"zUh27hTBgy"}],"key":"o80pagdK9q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"EconLineGraph(dataframe = quarterly,\n          series = ['hpcycle_gdp'],\n          title = 'Real GDP Cyclical Component\\n',\n          subtitle = 'Log of Trillions of 2017 Dollars',\n          source = 'BEA',\n          start_date = '1947-01-01',\n          graph_name = 'hp_cycle_log_real_gdp',\n          yzero = True,\n          logscale= False)","key":"OXvKG86zGM"},{"type":"outputs","id":"4jNYX8TKJIvCnWPRAo3CM","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bc2f5c993d18709ef12125cf68a5ae9d","path":"/bc2f5c993d18709ef12125cf68a5ae9d.png"},"text/plain":{"content":"<Figure size 1050x650 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"HKIGg4zERJ"}],"key":"heJyvbjByG"}],"key":"l02wVDnjwW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Homework #1:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gfe2L9V7QP"}],"key":"Ilq63v3hHz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"(A) Use a very large number for ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ulTz0vvp0r"},{"type":"inlineMath","value":"\\lambda","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span>","key":"x2dG27f9wH"},{"type":"text","value":", like 16000000000 and see the trend and cycle. Explain what is going on. Next plot the cylical component for the two different ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TYtsp0YsBb"},{"type":"inlineMath","value":"\\lambda","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span>","key":"eUX7A37xqH"},{"type":"text","value":"’s and comment on the difference.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CTVFI3Icec"}],"key":"ftIycq7gIg"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"(B) Download GDPCA from FRED. This is annual real GDP back to 1929. Should you use ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lKJubK3Ubd"},{"type":"inlineMath","value":"\\lambda=1600","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>1600</mn></mrow><annotation encoding=\"application/x-tex\">\\lambda=1600</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1600</span></span></span></span>","key":"xgY6barVWp"},{"type":"text","value":"? Why or why not? If not, what value should you use? Why?","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yG4iAs80Od"}],"key":"uET1ztt3XO"}],"key":"aHB11fXFVc"}],"key":"FpspR47yGj"},"references":{"cite":{"order":[],"data":{}}}}